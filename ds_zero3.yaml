compute_environment: LOCAL_MACHINE
debug: false
deepspeed_config:
  # ZeRO-3: Shards model, gradients, AND optimizer states
  zero_optimization:
    stage: 3
    offload_optimizer:
      device: none 
      # pin_memory: true
    offload_param:
      device: none 
    overlap_comm: true
    contiguous_gradients: true
    sub_group_size: 1e9
    reduce_bucket_size: auto
    stage3_prefetch_bucket_size: auto
    stage3_param_persistence_threshold: auto
    stage3_max_live_parameters: 1e9
    stage3_max_reuse_distance: 1e9
    stage3_gather_16bit_weights_on_model_save: true

  # Batch size control
  gradient_accumulation_steps: 2 
  gradient_clipping: auto
  steps_per_print: 10
  train_batch_size: auto
  train_micro_batch_size_per_gpu: auto

  # Precision 
  bf16:
    enabled: true

distributed_type: DEEPSPEED
downcast_bf16: 'no'
machine_rank: 0
main_training_function: main
# mix_precision: bf16
num_machines: 1
num_processes: 2  # No. of GPUs
use_cpu: false